# Clustering Practice

## 概要
このプロジェクトは、文章データに対してセマンティック・クラスタリングを行い、その結果を可視化するためのツールです。
事前学習済みの日本語埋め込みモデル（Sentence Transformers）を使用し、階層的なタグ定義に基づいてテキストデータを自動的に分類・分析します。
Gradioを用いたWeb UIを提供しており、直感的な操作でデータのアップロードから分析、結果の確認までを行うことができます。

## 主な機能

- **データの読み込み**: CSV形式のテキストデータをアップロードして分析できます。
- **柔軟なクラスタリング**: JSON形式で定義されたタグ（クラスタ）定義に基づき、テキストを分類します。タグ定義により、分析の粒度や観点を自由に調整可能です。
- **モデル選択**: 複数の高性能な日本語埋め込みモデル（`cl-nagoya/ruri` シリーズ, `sbintuitions/sarashina` 等）から、用途やリソースに合わせて選択できます。
- **インタラクティブな可視化**: 分析結果を2次元の散布図として表示し、マウスオーバーやズーム操作で詳細を確認できます。
- **結果の保存**: クラスタリング結果（スコア付与済みデータ）をCSVファイルとしてダウンロード可能です。

## 必要要件

- Python 3.8 以上
- 以下の主要ライブラリ（詳細は `requirements.txt` を参照）
    - pandas
    - numpy
    - scikit-learn
    - sentence-transformers
    - gradio
    - plotly
    - matplotlib / japanize-matplotlib
    - umap-learn

## セットアップ

リポジトリをクローンし、必要なライブラリをインストールしてください。

```bash
pip install -r requirements.txt
```

## 使い方

### Web UI の起動

以下のコマンドを実行して Gradio アプリケーションを起動します。

```bash
python gradio_app.py
```

起動後、ターミナルに表示されるURL（例: `http://0.0.0.0:7860`）にブラウザでアクセスしてください。

### UI での操作フロー

1. **CSV のアップロード**: 分析したいテキストデータを含むCSVファイルを選択します。
2. **タグ設定**: 分類の基準となるタグ定義を、JSONファイルのアップロードまたはテキストエリアへの直接入力で指定します。
3. **モデル選択**: 使用する埋め込みモデルを選択します。
4. **分析設定**: 必要に応じて正規化オプションなどを設定し、「分析を実行」をクリックします。
5. **結果確認**: 画面右側にクラスタリングの可視化結果、下部に詳細なデータテーブルが表示されます。
6. **ダウンロード**: 結果をCSVファイルとしてダウンロードできます。

## ファイル構成

- `gradio_app.py`: Web UI のメインスクリプト
- `main.py`: CLI 実行用のメインスクリプト
- `src/`: ソースコードディレクトリ
    - `pipeline.py`: 分析パイプラインの制御
    - `scoring.py`: 類似度スコアの計算ロジック
    - `clustering.py`: クラスタリング処理
    - `visualization.py`: 可視化処理
    - `analysis.py`: 分析ユーティリティ
- `data/`: データファイル用ディレクトリ（入力CSVや出力結果）
- `tags.json`: タグ定義のサンプルファイル
- `requirements.txt`: 依存ライブラリ一覧
